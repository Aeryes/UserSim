<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RL Agent Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="content">
        <h1>Test AgentX - Agent Dashboard</h1>

        {% if success %}
            <div class="alert success">üöÄ Training has begun successfully.</div>
        {% elif error %}
            <div class="alert error">‚ùå Error: {{ error }}</div>
        {% endif %}

        <form id="training-form" method="POST">
            <label for="episodes">Number of Episodes:</label><br>
            <input type="number" id="episodes" name="episodes" value="10" required><br><br>

            <label for="use_llm">Use LLM:</label><br>
            <select id="use_llm" name="use_llm">
                <option value="true" selected>True</option>
                <option value="false">False</option>
            </select><br><br>

            <label for="start_url">Start URL:</label><br>
            <input type="url" id="start_url" name="start_url" placeholder="https://example.com" required><br><br>

            <label for="max_obs_tokens">Max Observation Tokens:</label><br>
            <input type="number" id="max_obs_tokens" name="max_obs_tokens" value="5000" min="100" max="10000" step="100"><br><br>

            <button type="submit" onclick="startTraining()">Run Training</button>
            <button type="button" onclick="stopTraining()">Stop Training</button>
            <button type="button" onclick="wipeLogs()">Wipe Logs</button>
        </form>

        <h2>Live Log Output</h2>
        <div id="log-box" style="max-height: 300px; overflow-y: auto; background: #111; padding: 1em; border: 1px solid #64ffda; white-space: pre-line;"></div>
    </div>

    <script>
        function startTraining() {
            const form = document.getElementById("training-form");
            form.action = "/v1/run-training";
        }

        function stopTraining() {
            fetch("/v1/stop-training", { method: "POST" })
                .then(() => {
                    const logBox = document.getElementById("log-box");
                    const entry = document.createElement("div");
                    entry.textContent = "üõë Training is stopping...";
                    logBox.appendChild(entry);
                    logBox.scrollTop = logBox.scrollHeight;
                });
        }

        function wipeLogs() {
            fetch("/v1/wipe-logs", { method: "POST" })
                .then(() => {
                    const logBox = document.getElementById("log-box");
                    logBox.innerHTML = "";
                });
        }

        // Auto-hide alert messages after 5 seconds
        setTimeout(() => {
            const alertBox = document.querySelector('.alert');
            if (alertBox) {
                alertBox.style.transition = "opacity 0.5s ease";
                alertBox.style.opacity = "0";
                setTimeout(() => alertBox.remove(), 500);
            }
        }, 5000);

        async function fetchLogs() {
            try {
                const res = await fetch("/v1/logs");
                const data = await res.json();
                const logBox = document.getElementById("log-box");
                if (data.logs && data.logs.length > 0) {
                    data.logs.forEach(log => {
                        const entry = document.createElement("div");
                        entry.textContent = log;
                        logBox.appendChild(entry);
                    });
                    logBox.scrollTop = logBox.scrollHeight;
                }
            } catch (e) {
                console.error("Failed to fetch logs:", e);
            }
        }

        setInterval(fetchLogs, 10000);
        fetchLogs();
    </script>
</body>
</html>
